server {
    listen                              80;
        listen                              [::]:80;
    server_name                         gehaowu.com www.gehaowu.com;
    rewrite                             ^/(.*) https://www.gehaowu.com/$1 permanent;
    add_header                          Strict-Transport-Security max-age=31536000;
    access_log                          off;
    error_log                           off;
    log_not_found                       off;
}
server {
    listen                              443 ssl spdy;
        listen                              [::]:443 ssl spdy;
    ssl_certificate                     keys/www.gehaowu.com.crt;
    ssl_certificate_key                 keys/www.gehaowu.com.key;
    ssl_protocols                       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers                         HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4:!NULL!DH:!EDH:!AESGCM;
    ssl_prefer_server_ciphers           on;
    add_header                          Strict-Transport-Security max-age=31536000;
    ssl_session_cache                   shared:SSL:5m;
    ssl_session_timeout                 5m;
    ssl_trusted_certificate             keys/www.gehaowu.com.crt;
    ssl_stapling                        on;
    ssl_stapling_verify                 on;
    resolver                            8.8.8.8;
    server_name                         gehaowu.com;
    rewrite                             ^/(.*) https://www.gehaowu.com/$1 permanent;
    access_log                          off;
    error_log                           off;
    log_not_found                       off;
}
server {
    listen                              443 ssl spdy;
        listen                              [::]:443 ssl spdy ipv6only=on;
    ssl_certificate                     keys/www.gehaowu.com.crt;
    ssl_certificate_key                 keys/www.gehaowu.com.key;
    ssl_protocols                       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers                         HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4:!NULL!DH:!EDH:!AESGCM;
    ssl_prefer_server_ciphers           on;
    add_header                          Strict-Transport-Security max-age=31536000;
    ssl_session_cache                   shared:SSL:5m;
    ssl_session_timeout                 5m;
    ssl_trusted_certificate             keys/www.gehaowu.com.crt;
    ssl_stapling                        on;
    ssl_stapling_verify                 on;
    resolver                            8.8.8.8 [2001:4860:4860::8888]:5353;
    server_name                         www.gehaowu.com;
    index                               index.html index.htm default.html;
    root                                /home/ghw/wwwroot;
    error_page                          404 /404.html;
    access_log                          /home/ghw/wwwlog/www.gehaowu.com.access.log;
    error_log                           /home/ghw/wwwlog/www.gehaowu.com.error.log;

#location = /blog {
#return 301 /blog/;
#}
#location                        ^~ /blog {
#proxy_pass                      https://gehaowu.github.io;
#proxy_redirect                  https://www.gehaowu.com/blog/ /blog/;
#proxy_set_header                Host gehaowu.github.io;
#proxy_set_header                X-Host gehaowu.github.io;
#proxy_set_header            X-Real-IP       $remote_addr;
#proxy_set_header                X-Forwarded-For $proxy_add_x_forwarded_for;
#}

# 反向代理 bookcase 子站
location = /bookcase {
    return 301 /bookcase/;
    }
location                        ^~ /bookcase {
        proxy_pass                      https://gehaowu.github.io;
        proxy_set_header                Host gehaowu.github.io;
        proxy_set_header                X-Host gehaowu.github.io;
        proxy_set_header                X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache                 ghw;
        proxy_cache_valid           200 302 1h;
        proxy_cache_valid           404 1m;

    }

# 静止访问 "." 开头的隐藏文件
    location                            ~ /\. {
        deny                            all;
    }

# robots.txt 、 favicon.ico ，status.gif 文件访问不记录日志
    location                            ~* ^/(favicon.ico|robots.txt|status.gif)$ {
        allow                           all;
        access_log                      off;
        error_log                       off;
        log_not_found                   off;
    }

# 静态文件超期
    location                            ~* \.(html|htm|css|xml|rss|gif|jpeg|jpg|js|atom|txt|png|ico|bmp|svg|doc|pdf|xhtml|mp3|ogg|mp4|mpeg|webm|)$ {
        expires                         max;
    }
}
